<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan QR Code</title>
    <script src="../JAVASCRIPT/html5-qrcode.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .row { display: flex; justify-content: center; flex-wrap: wrap; }
        .col { flex: 1; min-width: 300px; max-width: 500px; padding: 10px; text-align: center; }
        
        /* Camera Box */
        #reader { width: 100%; border: 1px solid #ccc; background: #eee; }
        
        /* Form Styling */
        input[type="text"] {
            width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 15px;
            border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;
        }
        button {
            padding: 10px 20px; background-color: #007bff; color: white;
            border: none; border-radius: 5px; cursor: pointer; width: 100%; font-size: 16px;
        }
        button:hover { background-color: #0056b3; }
        .result-box { margin-top: 20px; font-weight: bold; color: green; }
    </style>
</head>
<body>

<h2 style="text-align:center">Scan QR to Enter/Exit</h2>

<div class="row">
  <div class="col">
    <div id="reader"></div>
    <div id="scanResult" class="result-box">Camera Result: None</div>
  </div>

  <div class="col">
    <h4>Details</h4>
    <form action="../PHP/Entry.php" method="post" id="entryForm"> 
      
      <label>Enrollment Number:</label>
      <input type="text" id="enroll_no" name="enroll_no" placeholder="Enter your Enroll No" required>
      
      <label>Place (Scanned):</label>
      <input type="text" id="place" name="place" readonly required>
      
      <label>Room Number (Scanned):</label>
      <input type="text" id="room_no" name="room_no" readonly required>
      
      <input type="hidden" id="qr_no" name="qr_no" value="scanned_data">

      <button type="submit">Submit Entry</button>
    </form>
  </div>
</div>

<script type="text/javascript">
    // 2. The Scanning Logic
    function onScanSuccess(decodedText, decodedResult) {
        // Stop the scan once successful (optional, but good for UX)
        // html5QrcodeScanner.clear(); 

        // Show result on screen
        document.getElementById('scanResult').innerText = "Scanned: " + decodedText;

        // 3. INTELLIGENT FILLING
        // We assume the QR code contains text like: "CC3,Lab-1"
        // We split the text by the comma
        const data = decodedText.split(",");

        if(data.length >= 2) {
            // If QR is "CC3,Lab-1"
            document.getElementById('place').value = data[0].trim();   // Fills 'CC3'
            document.getElementById('room_no').value = data[1].trim(); // Fills 'Lab-1'
        } else {
            // If QR is just "CC3"
            document.getElementById('place').value = decodedText;
        }
        
        // Optional: Play a beep sound
        // var audio = new Audio('beep.mp3'); audio.play();
    }

    function onScanFailure(error) {
        // handle scan failure, usually better to ignore and keep scanning.
        // console.warn(`Code scan error = ${error}`);
    }

    // Initialize the Scanner
    let html5QrcodeScanner = new Html5QrcodeScanner(
        "reader",
        { fps: 10, qrbox: {width: 250, height: 250} },
        /* verbose= */ false);
    
    html5QrcodeScanner.render(onScanSuccess, onScanFailure);
</script>

</body>
</html>